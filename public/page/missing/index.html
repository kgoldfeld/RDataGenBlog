<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>ouR data generation</title>
  <meta property="og:title" content="ouR data generation" />
  <meta name="twitter:title" content="ouR data generation" />
  <meta name="description" content="Missing data After generating a complete data set, it is possible to generate missing data. defMiss defines the parameters of missingness. genMiss generates a missing data matrix of indicators for each field. Indicators are set to 1 if the data are missing for a subject, 0 otherwise. genObs creates a data set that reflects what would have been observed had data been missing; this is a replicate of the orginal data set with “NAs” replacing values where missing data has been generated.">
  <meta property="og:description" content="Missing data After generating a complete data set, it is possible to generate missing data. defMiss defines the parameters of missingness. genMiss generates a missing data matrix of indicators for each field. Indicators are set to 1 if the data are missing for a subject, 0 otherwise. genObs creates a data set that reflects what would have been observed had data been missing; this is a replicate of the orginal data set with “NAs” replacing values where missing data has been generated.">
  <meta name="twitter:description" content="Missing data After generating a complete data set, it is possible to generate missing data. defMiss defines the parameters of missingness. genMiss generates a missing data matrix of indicators for …">
  <meta name="author" content="Keith Goldfeld"/>
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="/page/missing/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="ouR data generation" />

  <meta name="generator" content="Hugo 0.26" />
  <link rel="canonical" href="/page/missing/" />
  <link rel="alternate" href="/index.xml" type="application/rss+xml" title="ouR data generation">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="/css/pygment_highlights.css" />
  <link rel="stylesheet" href="/css/highlight.min.css" />

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-101083152-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/">ouR data generation</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="About" href="/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="simstudy" href="/page/simstudy">simstudy</a>
            </li>
          
        
          
            <li>
              <a title="shiny" href="/page/shiny">shiny</a>
            </li>
          
        
          
            <li>
              <a title="NYUSOM" href="https://med.nyu.edu/pophealth/department-population-health">NYUSOM</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  <div class="intro-header"></div>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <div id="missing-data" class="section level2">
<h2>Missing data</h2>
<p>After generating a complete data set, it is possible to generate missing data. <code>defMiss</code> defines the parameters of missingness. <code>genMiss</code> generates a missing data matrix of indicators for each field. Indicators are set to 1 if the data are missing for a subject, 0 otherwise. <code>genObs</code> creates a data set that reflects what would have been observed had data been missing; this is a replicate of the orginal data set with “NAs” replacing values where missing data has been generated.</p>
<p>By controlling the parameters of missingness, it is possible to represent different missing data mechanisms: (1) <em>missing completely at random</em> (MCAR), where the probability missing data is independent of any covariates, measured or unmeasured, that are associated with the measure, (2) <em>missing at random</em> (MAR), where the probability of subject missing data is a function only of observed covariates that are associated with the measure, and (3) <em>not missing at random</em> (NMAR), where the probability of missing data is related to unmeasured covariates that are associated with measure.</p>
<p>These possibilities are illustrated with an example. A data set of 1000 observations with three “outcome” measures&quot; <code>x1</code>, <code>x2</code>, and <code>x3</code> is defined. This data set also includes two independent predictors, <code>m</code> and <code>u</code> that largely determine the value of each outcome (subject to random noise).</p>
<pre class="r"><code>def1 &lt;- defData(varname = &quot;m&quot;, dist = &quot;binary&quot;, formula = 0.5)
def1 &lt;- defData(def1, &quot;u&quot;, dist = &quot;binary&quot;, formula = 0.5)
def1 &lt;- defData(def1, &quot;x1&quot;, dist = &quot;normal&quot;, formula = &quot;20*m + 20*u&quot;, variance = 2)
def1 &lt;- defData(def1, &quot;x2&quot;, dist = &quot;normal&quot;, formula = &quot;20*m + 20*u&quot;, variance = 2)
def1 &lt;- defData(def1, &quot;x3&quot;, dist = &quot;normal&quot;, formula = &quot;20*m + 20*u&quot;, variance = 2)

dtAct &lt;- genData(1000, def1)</code></pre>
<p>In this example, the missing data mechanism is different for each outcome. As defined below, missingness for <code>x1</code> is MCAR, since the probability of missing is fixed. Missingness for <code>x2</code> is MAR, since missingness is a function of <code>m</code>, a measured predictor of <code>x2</code>. And missingness for <code>x3</code> is NMAR, since the probability of missing is dependent on <code>u</code>, an unmeasured predictor of <code>x3</code>:</p>
<pre class="r"><code>defM &lt;- defMiss(varname = &quot;x1&quot;, formula = 0.15, logit.link = FALSE)
defM &lt;- defMiss(defM, varname = &quot;x2&quot;, formula = &quot;.05 + m * 0.25&quot;, logit.link = FALSE)
defM &lt;- defMiss(defM, varname = &quot;x3&quot;, formula = &quot;.05 + u * 0.25&quot;, logit.link = FALSE)
defM &lt;- defMiss(defM, varname = &quot;u&quot;, formula = 1, logit.link = FALSE)  # not observed

missMat &lt;- genMiss(dtAct, defM, idvars = &quot;id&quot;)
dtObs &lt;- genObs(dtAct, missMat, idvars = &quot;id&quot;)</code></pre>
<pre class="r"><code>missMat</code></pre>
<pre><code>##         id x1 x2 x3 u m
##    1:    1  0  1  0 1 0
##    2:    2  0  0  0 1 0
##    3:    3  0  1  0 1 0
##    4:    4  1  0  0 1 0
##    5:    5  0  0  0 1 0
##   ---                  
##  996:  996  1  0  1 1 0
##  997:  997  0  0  1 1 0
##  998:  998  0  0  0 1 0
##  999:  999  0  1  0 1 0
## 1000: 1000  0  0  0 1 0</code></pre>
<pre class="r"><code>dtObs</code></pre>
<pre><code>##         id m  u       x1       x2       x3
##    1:    1 1 NA 38.15202       NA 42.04077
##    2:    2 0 NA 17.54314 20.66449 22.92991
##    3:    3 1 NA 19.29560       NA 20.08308
##    4:    4 1 NA       NA 39.55953 39.36842
##    5:    5 0 NA 19.38124 18.98206 20.39490
##   ---                                     
##  996:  996 0 NA       NA 20.17655       NA
##  997:  997 1 NA 37.37646 40.79057       NA
##  998:  998 1 NA 20.74872 17.06081 18.25915
##  999:  999 1 NA 21.31908       NA 18.51244
## 1000: 1000 1 NA 21.38929 17.46122 18.73815</code></pre>
<p>The impacts of the various data mechanisms on estimation can be seen with a simple calculation of means using both the “true” data set without missing data as a comparison for the “observed” data set. Since <code>x1</code> is MCAR, the averages for both data sets are roughly equivalent. However, we can see below that estimates for <code>x2</code> and <code>x3</code> are biased, as the difference between observed and actual is not close to 0:</p>
<pre class="r"><code># Two functions to calculate means and compare them

rmean &lt;- function(var, digits = 1) {
    round(mean(var, na.rm = TRUE), digits)
}

showDif &lt;- function(dt1, dt2, rowName = c(&quot;Actual&quot;, &quot;Observed&quot;, &quot;Difference&quot;)) {
    dt &lt;- data.frame(rbind(dt1, dt2, dt1 - dt2))
    rownames(dt) &lt;- rowName
    return(dt)
}

# data.table functionality to estimate means for each data set

meanAct &lt;- dtAct[, .(x1 = rmean(x1), x2 = rmean(x2), x3 = rmean(x3))]
meanObs &lt;- dtObs[, .(x1 = rmean(x1), x2 = rmean(x2), x3 = rmean(x3))]

showDif(meanAct, meanObs)</code></pre>
<pre><code>##              x1   x2   x3
## Actual     20.9 20.9 20.8
## Observed   20.9 19.3 19.2
## Difference  0.0  1.6  1.6</code></pre>
<p>After adjusting for the measured covariate <code>m</code>, the bias for the estimate of the mean of <code>x2</code> is mitigated, but not for <code>x3</code>, since <code>u</code> is not observed:</p>
<pre class="r"><code>meanActm &lt;- dtAct[, .(x1 = rmean(x1), x2 = rmean(x2), x3 = rmean(x3)), keyby = m]
meanObsm &lt;- dtObs[, .(x1 = rmean(x1), x2 = rmean(x2), x3 = rmean(x3)), keyby = m]</code></pre>
<pre class="r"><code># compare observed and actual when m = 0

showDif(meanActm[m == 0, .(x1, x2, x3)], meanObsm[m == 0, .(x1, x2, x3)])</code></pre>
<pre><code>##              x1   x2   x3
## Actual     10.5 10.5 10.6
## Observed   10.3 10.5  9.1
## Difference  0.2  0.0  1.5</code></pre>
<pre class="r"><code># compare observed and actual when m = 1

showDif(meanActm[m == 1, .(x1, x2, x3)], meanObsm[m == 1, .(x1, x2, x3)])</code></pre>
<pre><code>##              x1   x2   x3
## Actual     29.9 30.0 29.7
## Observed   30.0 30.3 28.1
## Difference -0.1 -0.3  1.6</code></pre>
</div>
<div id="longitudinal-data-with-missingness" class="section level2">
<h2>Longitudinal data with missingness</h2>
<p>Missingness can occur, of course, in the context of longitudinal data. <code>missDef</code> provides two additional arguments that are relevant for these types of datas: <code>baseline</code> and <code>monotonic</code>. In the case of variables that are measured at baseline only, a missing value would be reflected throughout the course of the study. In the case where a variable is time-dependent (i.e it is measured at each time point), it is possible to declare missingness to be <em>monotonic</em>. This means that if a value for this field is missing at time <code>t</code>, then values will also be missing at all times <code>T &gt; t</code> as well. The call to <code>genMiss</code> must set <code>repeated</code> to TRUE.</p>
<p>The following two examples describe an outcome variable <code>y</code> that is measured over time, whose value is a function of time and an observed exposure:</p>
<pre class="r"><code># use baseline definitions from previous example

dtAct &lt;- genData(120, def1)
dtAct &lt;- trtObserve(dtAct, formulas = 0.5, logit.link = FALSE, grpName = &quot;rx&quot;)

# add longitudinal data

defLong &lt;- defDataAdd(varname = &quot;y&quot;, dist = &quot;normal&quot;, formula = &quot;10 + period*2 + 2 * rx&quot;, 
    variance = 2)

dtTime &lt;- addPeriods(dtAct, nPeriods = 4)
dtTime &lt;- addColumns(defLong, dtTime)</code></pre>
<p>In the first case, missingness is not monotonic; a subject might miss a measurement but returns for subsequent measurements:</p>
<pre class="r"><code># missingness for y is not monotonic

defMlong &lt;- defMiss(varname = &quot;x1&quot;, formula = 0.2, baseline = TRUE)
defMlong &lt;- defMiss(defMlong, varname = &quot;y&quot;, formula = &quot;-1.5 - 1.5 * rx + .25*period&quot;, 
    logit.link = TRUE, baseline = FALSE, monotonic = FALSE)

missMatLong &lt;- genMiss(dtTime, defMlong, idvars = c(&quot;id&quot;, &quot;rx&quot;), repeated = TRUE, 
    periodvar = &quot;period&quot;)</code></pre>
<p>Here is a conceptual plot that shows the pattern of missingness. Each row represents an individual, and each box represents a time period. A box that is colored reflects missing data; a box colored grey reflects observed. The missingness pattern is shown for two variables <code>x1</code> and <code>y</code>:</p>
<p><img src="/page/missing_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p>In the second case, missingness is monotonic; once a subject misses a measurement for <code>y</code>, there are no subsequent measurements:</p>
<pre class="r"><code># missingness for y is not monotonic

defMlong &lt;- defMiss(varname = &quot;x1&quot;, formula = 0.2, baseline = TRUE)
defMlong &lt;- defMiss(defMlong, varname = &quot;y&quot;, formula = &quot;-1.8 - 1.5 * rx + .25*period&quot;, 
    logit.link = TRUE, baseline = FALSE, monotonic = TRUE)

missMatLong &lt;- genMiss(dtTime, defMlong, idvars = c(&quot;id&quot;, &quot;rx&quot;), repeated = TRUE, 
    periodvar = &quot;period&quot;)</code></pre>
<p><img src="/page/missing_files/figure-html/unnamed-chunk-12-1.png" width="672" /></p>
</div>

      </article>

      <ul class="pager blog-pager">
       
      </ul>

      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:keith.goldfeld@nyumc.org" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Keith Goldfeld
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="/">ouR data generation</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.26</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="/js/main.js"></script>
<script src="/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>





  </body>
</html>

