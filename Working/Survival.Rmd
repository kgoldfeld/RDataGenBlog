---
comments: false
---

## Survival data

Time-to-event data, including both survival and censoring times, are created using functions `defSurv` and `genSurv`. The survival data definitions require a variable name as well as a specification of a scale value, which determines the mean survival time at a baseline level of covariates (i.e. all covariates set to 0). The Weibull distribution is used to generate these survival times. In addition, covariates (which have been defined previously) that influence survival time can be included in the `formula` field. Positive coeffecients are associated with longer survival times (and lower hazard rates). Finally, the *shape* of the distribution can be specified. A `shape` value of 1 reflects the *exponential* distribution.

```{r, tidy = TRUE, eval = FALSE}

# Baseline data definitions

def <- defData(varname = "x1", formula = .5, dist = "binary")
def <- defData(def,varname = "x2", formula = .5, dist = "binary")
def <- defData(def,varname = "grp", formula = .5, dist = "binary")

# Survival data definitions

sdef <- defSurv(varname = "survTime", formula = "1.5*x1", scale = "grp*50 + (1-grp)*25", shape = "grp*1 + (1-grp)*1.5")
sdef <- defSurv(sdef, varname = "censorTime", scale = 80, shape = 1)

sdef

```

![](/page/Test_files/figure-html/sdef-1.png){ width=90% }


The data are generated with calls to `genData` and `genSurv`:

```{r, tidy = TRUE, eval = FALSE}

# Baseline data definitions

dtSurv <- genData(300, def)
dtSurv <- genSurv(dtSurv, sdef)

head(dtSurv)
```

![](/page/Test_files/figure-html/dtSurv-1.png){ width=70% }


```{r, tidy=TRUE, eval=FALSE}

# A comparison of survival by group and x1

dtSurv[,round(mean(survTime),1), keyby = .(grp,x1)]

```

![](/page/Test_files/figure-html/compare-1.png){ width=70% }


Observed survival times and censoring indicators can be generated by defining new fields:

```{r, tidy = TRUE, eval = FALSE}

cdef <- defDataAdd(varname = "obsTime", formula = "pmin(survTime, censorTime)", dist="nonrandom")
cdef <- defDataAdd(cdef, varname = "status", formula = "I(survTime <= censorTime)",dist="nonrandom")

dtSurv <- addColumns(cdef, dtSurv)

head(dtSurv)
```

![](/page/Test_files/figure-html/dtSurv2-1.png){ width=70% }

```{r, tidy=TRUE, eval=FALSE}
# estimate proportion of censoring by x1 and group

dtSurv[,round(1-mean(status),2), keyby = .(grp,x1)]
```

![](/page/Test_files/figure-html/compare2-1.png){ width=70% }


Here is a Kaplan-Meier plot of the data by the four groups:

![](/page/Test_files/figure-html/kmplot-1.png){ width=90% }

