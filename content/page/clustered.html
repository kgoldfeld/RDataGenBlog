---
comments: false
---



<div id="clustered-data" class="section level2">
<h2>Clustered data</h2>
<p>The function <code>genCluster</code> generates multilevel or clustered data based on a previously generated data set that is one “level” up from the clustered data. For example, if there is a data set that contains school level (considered here to be level 2), classrooms (level 1) can be generated. And then, students (now level 1) can be generated within classrooms (now level 2)</p>
<p>In the example here, we do in fact generate school, class, and student level data. There are eight schools, four of which are randomized to receive an intervention. The number of classes per school varies, as does the number of students per class. (It is straightforward to generate fully balanced data by using constant values.) The outcome of interest is a test score, which is influenced by gender and the intervention. In addition, test scores vary by schools, and by classrooms, so the simulation provides <em>random effects</em> at each of these levels.</p>
<p>We start by definining the school level data:</p>
<pre class="r"><code>gen.school &lt;- defData(varname = &quot;s0&quot;, dist = &quot;normal&quot;, formula = 0, variance = 3, 
    id = &quot;idSchool&quot;)
gen.school &lt;- defData(gen.school, varname = &quot;nClasses&quot;, dist = &quot;noZeroPoisson&quot;, 
    formula = 3)

dtSchool &lt;- genData(8, gen.school)
dtSchool &lt;- trtAssign(dtSchool, n = 2)

dtSchool</code></pre>
<p>The classroom level data are generated with a call to <code>genCluster</code>, and then school level data is added by a call to <code>addColumns</code>:</p>
<pre class="r"><code>gen.class &lt;- defDataAdd(varname = &quot;c0&quot;, dist = &quot;normal&quot;, formula = 0, variance = 2)
gen.class &lt;- defDataAdd(gen.class, varname = &quot;nStudents&quot;, dist = &quot;noZeroPoisson&quot;, 
    formula = 20)

dtClass &lt;- genCluster(dtSchool, &quot;idSchool&quot;, numIndsVar = &quot;nClasses&quot;, level1ID = &quot;idClass&quot;)
dtClass &lt;- addColumns(gen.class, dtClass)

head(dtClass, 10)</code></pre>
<pre><code>##     idSchool trtGrp        s0 nClasses idClass          c0 nStudents
##  1:        1      1 -1.959191        6       1  0.96934528        16
##  2:        1      1 -1.959191        6       2  0.28312085        22
##  3:        1      1 -1.959191        6       3 -0.27465592        15
##  4:        1      1 -1.959191        6       4  1.32220303        17
##  5:        1      1 -1.959191        6       5 -0.04551195        16
##  6:        1      1 -1.959191        6       6  1.46580501        31
##  7:        2      1 -3.364848        4       7 -0.56800631        30
##  8:        2      1 -3.364848        4       8 -1.71631061        20
##  9:        2      1 -3.364848        4       9  1.32885766        14
## 10:        2      1 -3.364848        4      10 -2.63177885        21</code></pre>
<p>Finally, the student level data are added using the same process:</p>
<pre class="r"><code>gen.student &lt;- defDataAdd(varname = &quot;Male&quot;, dist = &quot;binary&quot;, 
    formula = 0.5)
gen.student &lt;- defDataAdd(gen.student, varname = &quot;age&quot;, dist = &quot;uniform&quot;, 
    formula = &quot;9.5; 10.5&quot;)
gen.student &lt;- defDataAdd(gen.student, varname = &quot;test&quot;, dist = &quot;normal&quot;, 
    formula = &quot;50 - 5*Male + s0 + c0 + 8 * trtGrp&quot;, variance = 2)
dtStudent &lt;- genCluster(dtClass, cLevelVar = &quot;idClass&quot;, numIndsVar = &quot;nStudents&quot;, 
    level1ID = &quot;idChild&quot;)

dtStudent &lt;- addColumns(gen.student, dtStudent)</code></pre>
<p>This is what the clustered data look like. Each classroom is represented by a box, and each school is represented by a color. The intervention group is highlighted by dark outlines:</p>
<p><img src="/page/clustered_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
</div>
