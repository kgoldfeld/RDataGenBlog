---
title: Exploring design effects of stepped wedge designs with baseline measurements
author: Keith Goldfeld
date: '2021-12-07'
slug: []
categories: []
tags:
  - R
  - Cluster randomized trials
type: ''
subtitle: ''
image: ''
draft: TRUE
---

<script src="{{< blogdown/postref >}}index.en_files/header-attrs/header-attrs.js"></script>


<p>In the <a href="https://www.rdatagen.net/post/2021-11-23-design-effects-with-baseline-measurements/" target="_blank">previous post</a>, I described an incipient effort that I am undertaking with two colleagues, Monica Taljaard and Fan Li, to better understand the implications for collecting baseline measurements on sample size requirements for stepped wedge cluster randomized trials. (The three of us are on the <a href="https://impactcollaboratory.org/design-and-statistics-core/" target="_blank">Design and Statistics Core</a> of the <a href="https://impactcollaboratory.org/" target="_blank">NIA IMPACT Collaboratory</a>.) In that post, I conducted a series of simulations that illustrated the design effects in parallel cluster randomized trials derived analytically in a <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/sim.5352" target="_blank">paper</a> by <em>Teerenstra et al</em>. In this post, I am extending those simulations to stepped wedge trials; the hope is that the design effects can be formally derived some point soon.</p>
<div id="stepped-wedge-designs" class="section level2">
<h2>Stepped wedge designs</h2>
<p>At the end of the previous post, I provided links to a few earlier entries where I described stepped wedge designs in some detail. The first <a href="https://www.rdatagen.net/post/alternatives-to-stepped-wedge-designs/" target="_blank">post</a> I suggested provides an introductory overview.</p>
<p>In the stepped-wedge design, all clusters in a trial will receive the intervention at some point, but the start of the intervention at different sites will be staggered. The amount of time in each state (control or intervention) will differ for each cluster (or group of clusters if there are waves of more than one cluster starting up at the same time). In this design, time is divided into discrete data collection/phase-in periods.</p>
<p>In the figure below there are four waves of clusters (the rows), with sets of five clusters (the columns) in each wave. All waves are in the control condition in the first observation period, Wave 1 starts the intervention in period 2, Wave 2 starts in period 3, Wave 3 in period 4, and the last wave starts in period 5. Data from individuals in each cluster are collected for all periods, regardless of intervention status. The points in the figure represent individual (follow-up) responses within each cluster and time period.</p>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
</div>
<div id="data-generation-process" class="section level2">
<h2>Data generation process</h2>
<p>In order to accommodate a range of scenarios, I’ve written a general function <code>base_sw</code> that will be used in the data generating process (see <a href="#addendum">addendum</a>). This function allows for time period effects (specified as a time trend) as well as all the possible cluster and individual random effects. Importantly, this function will generate two outcome measures for each subject within a specific cluster and time period.</p>
<p>This is the general data generation process that I’ve used here:</p>
<p><span class="math display">\[
Y_{ijkt} = \tau  (t-1) +  \gamma k Z_{jt}   + c_j  + cp_{jt} + s_{ijt} + sp_{ijkt},
\]</span></p>
<p>where <span class="math inline">\(Y_{ijkt}\)</span> is the outcome for subject <span class="math inline">\(i\)</span> in cluster <span class="math inline">\(j\)</span> measured in period <span class="math inline">\(t,\)</span> <span class="math inline">\(t \in \{1,\dots, T\};\)</span> <span class="math inline">\(k \in \{0, 1\}, \ k=0\)</span> if the measurement is taken at baseline and <span class="math inline">\(k=1\)</span> if the measurement is the follow-up. <span class="math inline">\(Z_{jt}\)</span> is a treatment indicator for cluster <span class="math inline">\(j\)</span> during period <span class="math inline">\(t\)</span>.</p>
<p>The parameter <span class="math inline">\(\tau\)</span> is the general time trend. (The linear time trend is not a requirement - it is just what I am using here to easily generate time period effects.) <span class="math inline">\(\gamma\)</span> is the treatment effect, which can only impact follow-up measurements. <span class="math inline">\(c_j\)</span> and <span class="math inline">\(cp_{jt}\)</span> are the cluster and cluster-period specific random effects with distributions <span class="math inline">\(N(0, \sigma_c^2)\)</span> and <span class="math inline">\(N(0, \sigma_{cp}^2)\)</span>, respectively. <span class="math inline">\(s_{ijt}\)</span> is the subject-level effect (and is specific to period <span class="math inline">\(t\)</span> since the subject is only observed in that period), <span class="math inline">\(s_{ijt} \sim N(0, \sigma_{s}^2)\)</span>. <span class="math inline">\(sp_{ijkt}\)</span> is the measurement noise, <span class="math inline">\(sp_{ijkt} \sim N(0, \sigma_{sp}^2).\)</span></p>
<p>The <a href="#addendum">code</a> itself is a little involved, because there are two longitudinal processes that need to be combined - clusters are repeated over time and subjects are repeated over time within each cluster period. In addition, there are two possible layers of cluster and subject random effects.</p>
<p>Below are three plots of data generated from three possible scenarios, using ten sites divided into two waves. The first scenario includes cluster and subject specific effects, but no fixed or random period effects. The second adds fixed period effects, and the third adds both fixed and random period effects:</p>
<pre class="r"><code>dd_1 &lt;- base_sw(
  effect = 1, 
  trend = 0, 
  nsites = 10, 
  nwaves = 2, 
  nperiods = 5, 
  n = 30, 
  s_c = 6, 
  s_cp = 0, 
  s_s = 44, 
  s_sp = 20
)

dd_2 &lt;- base_sw(1, 3, 10, 2, 5, 30, 6, 0, 44, 20)
dd_3 &lt;- base_sw(1, 3, 10, 2, 5, 30, 4, 2, 44, 20) </code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-8-1.png" width="576" /></p>
</div>
<div id="models-for-estimating-treatment-effects" class="section level2">
<h2>Models for estimating treatment effects</h2>
<p>Of course, given a data set, there are many ways we can choose to analyze it. Which model we pick depends in large part on the structure of the data and the assumptions we are willing to make about the data generation process. Here, we describe five models, all of which are linear mixed effects models. Ideally, we will choose the one that provides the most information given the data on hand, and we hope these explorations might help clarify which of these is our best bet.</p>
<p>To start, we are focusing on a situation where there is no cluster-period effect (Scenario 2 from above), so that <span class="math inline">\(cp_{jt} = 0\)</span> for all <span class="math inline">\(j\)</span> and <span class="math inline">\(t\)</span>. The true effect size <span class="math inline">\(\gamma = 1\)</span> and the time trend <span class="math inline">\(\tau = 3\)</span>. There will be 20 clusters divided into 4 waves of 5 clusters, with each wave starting in period <span class="math inline">\(t=1\)</span>, and the intervention is rolled out in periods 2 through 5, just as in the figure at the top. There will be 30 subjects for each cluster, each period. <span class="math inline">\(\sigma_c^2 = 6\)</span>, <span class="math inline">\(\sigma_{cp}^2 = 0\)</span>, <span class="math inline">\(\sigma_s^2 = 44\)</span>, and <span class="math inline">\(\sigma_{sp}^2 = 20.\)</span> (See the second part of the <a href="#addendum">addendum</a> for examples from Scenarios 1 and 3.)</p>
<p>Here is a data set generated under these assumptions:</p>
<pre class="r"><code>dd &lt;- base_sw(1, 3, 20, 4, 5, 30, 6, 0, 44, 20)
dd[, t := factor(s_per, labels = c(1:5))]

dd</code></pre>
<pre><code>##       s_time site s_per   id k    c c.p     s p_time startTrt Z    y t
##    1:      1    1     0    1 0  2.4   0 -0.43      1        1 0  3.4 1
##    2:      1    1     0    1 1  2.4   0 -0.43      2        1 0 -7.6 1
##    3:      1    1     0    2 0  2.4   0 12.76      3        1 0 10.4 1
##    4:      1    1     0    2 1  2.4   0 12.76      4        1 0  9.4 1
##    5:      1    1     0    3 0  2.4   0  0.89      5        1 0  2.5 1
##   ---                                                                 
## 5996:    100   20     4 2998 1 -3.9   0  0.72   5996        4 1 12.5 5
## 5997:    100   20     4 2999 0 -3.9   0  3.29   5997        4 1  9.6 5
## 5998:    100   20     4 2999 1 -3.9   0  3.29   5998        4 1 16.0 5
## 5999:    100   20     4 3000 0 -3.9   0  0.86   5999        4 1  2.7 5
## 6000:    100   20     4 3000 1 -3.9   0  0.86   6000        4 1  8.8 5</code></pre>
<p>And here is a subset of the data that we will actually be able to observe in the real world, which will be used to estimate the models:</p>
<pre class="r"><code>dd[, .(id, site, t, k, Z, y)]</code></pre>
<pre><code>##         id site t k Z    y
##    1:    1    1 1 0 0  3.4
##    2:    1    1 1 1 0 -7.6
##    3:    2    1 1 0 0 10.4
##    4:    2    1 1 1 0  9.4
##    5:    3    1 1 0 0  2.5
##   ---                     
## 5996: 2998   20 5 1 1 12.5
## 5997: 2999   20 5 0 1  9.6
## 5998: 2999   20 5 1 1 16.0
## 5999: 3000   20 5 0 1  2.7
## 6000: 3000   20 5 1 1  8.8</code></pre>
<p>Here is a description of each of the five models, along with code to estimate the models:</p>
<p><strong>Model 1: Hussey &amp; Hughes model with no baseline measurement</strong></p>
<p>If we do not have access to the baseline data (or for some reason, choose to ignore it in the modeling), we could fit the stepped wedge model described by <a href="https://www.sciencedirect.com/science/article/pii/S1551714406000632" target="_blank">Hussey &amp; Hughes</a>:</p>
<p><span class="math display">\[
Y_{ijt} = \alpha_t + \gamma Z_{jt} + c_j + s_{ijt},
\]</span></p>
<p>where <span class="math inline">\(Y_{ijt}\)</span> is the outcome for subject <span class="math inline">\(i\)</span> in cluster <span class="math inline">\(j\)</span> measured in period <span class="math inline">\(t\)</span>. <span class="math inline">\(Z_{jt}\)</span> is a treatment indicator for cluster <span class="math inline">\(j\)</span> during period <span class="math inline">\(t\)</span>. The <span class="math inline">\(\alpha_t\text{&#39;s}\)</span> are the period-specific fixed effects and <span class="math inline">\(\gamma\)</span> is the treatment effect. <span class="math inline">\(c_j\)</span> is the cluster specific random effects with distribution <span class="math inline">\(N(0, \sigma_c^2)\)</span>. <span class="math inline">\(s_{ijt}\)</span> is the subject-level effect or noise, <span class="math inline">\(s_{ijt} \sim N(0, \sigma_{s}^2).\)</span> Since there is only a single measurement for each subject, there is only a single subject-level effect. And because we have assumed no cluster-period random effects, <span class="math inline">\(cp_{jt}\)</span> is not included in the model (and will also be the case for the other models described below).</p>
<p>This model can be estimated using the <code>lmer</code> function in package <code>lme4</code>. Note that we are using only the follow-up data in the model estimation:</p>
<pre class="r"><code>d_std &lt;- dd[k == 1]
fit_1 &lt;-  lmer( y ~  t + Z  - 1 + (1|site), data = d_std)</code></pre>
<pre class="r"><code>tbl_regression(fit_1, tidy_fun = broom.mixed::tidy) %&gt;%
   modify_footnote(ci ~ NA, abbreviation = TRUE)</code></pre>
<div id="ipzkgaiyhw" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#ipzkgaiyhw .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ipzkgaiyhw .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ipzkgaiyhw .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ipzkgaiyhw .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ipzkgaiyhw .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ipzkgaiyhw .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ipzkgaiyhw .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ipzkgaiyhw .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ipzkgaiyhw .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ipzkgaiyhw .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ipzkgaiyhw .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ipzkgaiyhw .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#ipzkgaiyhw .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ipzkgaiyhw .gt_from_md > :first-child {
  margin-top: 0;
}

#ipzkgaiyhw .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ipzkgaiyhw .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ipzkgaiyhw .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#ipzkgaiyhw .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ipzkgaiyhw .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#ipzkgaiyhw .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ipzkgaiyhw .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ipzkgaiyhw .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ipzkgaiyhw .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ipzkgaiyhw .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ipzkgaiyhw .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#ipzkgaiyhw .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ipzkgaiyhw .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#ipzkgaiyhw .gt_left {
  text-align: left;
}

#ipzkgaiyhw .gt_center {
  text-align: center;
}

#ipzkgaiyhw .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ipzkgaiyhw .gt_font_normal {
  font-weight: normal;
}

#ipzkgaiyhw .gt_font_bold {
  font-weight: bold;
}

#ipzkgaiyhw .gt_font_italic {
  font-style: italic;
}

#ipzkgaiyhw .gt_super {
  font-size: 65%;
}

#ipzkgaiyhw .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">-0.73</td>
<td class="gt_row gt_center">-1.9, 0.43</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">2.9</td>
<td class="gt_row gt_center">1.7, 4.1</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">5.0</td>
<td class="gt_row gt_center">3.8, 6.3</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">8.3</td>
<td class="gt_row gt_center">7.0, 9.7</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">11</td>
<td class="gt_row gt_center">9.7, 13</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">1.0</td>
<td class="gt_row gt_center">-0.03, 2.0</td>
<td class="gt_row gt_center">0.057</td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">2.1</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">7.9</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
<p>The treatment and period effects are recovered quite well, as are the variance estimates of the random effects.</p>
<p><strong>Model 2: Hussey &amp; Hughes extended to baseline measurement</strong></p>
<p>If we have access to both baseline and follow-up outcome measurements for each subject, we have a number of modeling options, four of which are described here. First, we can extend the Hussey &amp; Hughes model to estimate the treatment effect. <strong>The baseline and follow-up measurements are assumed to be collected in the same period <span class="math inline">\(t\)</span>.</strong> The baseline measurement is collected prior to randomization (so will by definition be under the control condition). The follow-up measurement will be under the control or treatment condition, depending on the cluster and time period.</p>
<p><span class="math display">\[
Y_{ijkt} = \alpha_t +  \gamma k Z_{jt}  + c_j + s_{ijt} + sp_{ijkt},
\]</span></p>
<p>where <span class="math inline">\(Y_{ijkt}\)</span> is outcome <span class="math inline">\(k\)</span> for subject <span class="math inline">\(i\)</span> in cluster <span class="math inline">\(j\)</span> measured in period <span class="math inline">\(t\)</span>. <span class="math inline">\(k = 0\)</span> when the measurement is from baseline and <span class="math inline">\(k=1\)</span> when it is the follow-up. <span class="math inline">\(Z_{jt}\)</span> is a treatment indicator for cluster <span class="math inline">\(j\)</span> during period <span class="math inline">\(t\)</span>. The parameters <span class="math inline">\(\alpha_t\)</span> and <span class="math inline">\(\gamma\)</span> are the same as above. The random effect <span class="math inline">\(c_j\)</span> is also unchanged from the previous model. The subject-level effects of this model <em>are</em> different, reflecting the fact that there are now two measurements per subject: <span class="math inline">\(s_{ijt}\)</span> is the overall subject-level effect for subject <span class="math inline">\(i\)</span> in cluster <span class="math inline">\(j\)</span> during period <span class="math inline">\(t\)</span>, <span class="math inline">\(s_{ijt} \sim N(0,\sigma_s^2)\)</span> and <span class="math inline">\(sp_{ijkt}\)</span> is the measurement noise (which assumes that any two measurements from the same individual will vary), <span class="math inline">\(sp_{ijkt} \sim N(0,\sigma_{sp}^2)\)</span>.</p>
<p>Once again, the model estimates recover the true values pretty well:</p>
<pre class="r"><code>fit_2 &lt;- lmer(y ~ t + k:Z  - 1 +  (1|id:site) + (1|site), data = dd)</code></pre>
<div id="fpthzncayt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#fpthzncayt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#fpthzncayt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fpthzncayt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#fpthzncayt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#fpthzncayt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fpthzncayt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#fpthzncayt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#fpthzncayt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#fpthzncayt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#fpthzncayt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#fpthzncayt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#fpthzncayt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#fpthzncayt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#fpthzncayt .gt_from_md > :first-child {
  margin-top: 0;
}

#fpthzncayt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#fpthzncayt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#fpthzncayt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#fpthzncayt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fpthzncayt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#fpthzncayt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#fpthzncayt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#fpthzncayt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#fpthzncayt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#fpthzncayt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fpthzncayt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#fpthzncayt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#fpthzncayt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#fpthzncayt .gt_left {
  text-align: left;
}

#fpthzncayt .gt_center {
  text-align: center;
}

#fpthzncayt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#fpthzncayt .gt_font_normal {
  font-weight: normal;
}

#fpthzncayt .gt_font_bold {
  font-weight: bold;
}

#fpthzncayt .gt_font_italic {
  font-style: italic;
}

#fpthzncayt .gt_super {
  font-size: 65%;
}

#fpthzncayt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">-0.82</td>
<td class="gt_row gt_center">-2.0, 0.33</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">2.8</td>
<td class="gt_row gt_center">1.6, 3.9</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">5.1</td>
<td class="gt_row gt_center">4.0, 6.3</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">8.2</td>
<td class="gt_row gt_center">7.0, 9.3</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">11</td>
<td class="gt_row gt_center">9.9, 12</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">k * Z</td>
<td class="gt_row gt_center">1.1</td>
<td class="gt_row gt_center">0.74, 1.4</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">id:site.sd__(Intercept)</td>
<td class="gt_row gt_center">6.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">2.1</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">4.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
<p><strong>Model 3: Teerenstra et al difference in change model</strong></p>
<p>In the previous <a href="https://www.rdatagen.net/post/2021-11-23-design-effects-with-baseline-measurements/" target="_blank">post</a>, I described a “difference in change” model proposed in a paper by <a href="https://onlinelibrary.wiley.com/doi/full/10.1002/sim.5352" target="_blank">Teerenstra et al</a> for parallel designs. This can be extended to the context of a stepped wedge design:</p>
<p><span class="math display">\[
Y_{ijkt} = \alpha_t + \gamma_0 k + \gamma_1 Z_{jt} + \gamma_2 k Z_{jt} + c_j + s_{ijt} + sp_{ijkt}
\]</span></p>
<p>This is essentially the same as <em>Model 2</em>, though this expanded model makes slightly fewer assumptions. In particular, <em>Model 3</em> includes the additional parameters <span class="math inline">\(\gamma_0\)</span> and <span class="math inline">\(\gamma_1\)</span>, where <span class="math inline">\(\gamma_0\)</span> is the change from baseline to follow-up in the control arm and <span class="math inline">\(\gamma_{1}\)</span> is the difference at baseline between control and treatment arms (we would expect this to be <span class="math inline">\(0\)</span> in a randomized trial). <span class="math inline">\(\gamma_{2}\)</span> is the difference in the change from baseline to follow-up between the two arms. In <em>Model 2</em>, we essentially make the assumption that both <span class="math inline">\(\gamma_0 = 0\)</span> and <span class="math inline">\(\gamma_1=0\)</span>, which is probably true on average in a randomized trial with no secular trend between baseline and follow-up measurements (and is certainly true in our simulated data generation process). In this case, under the assumption of randomization and no within-period secular trend, <span class="math inline">\(\gamma_2\)</span> should be equivalent to <span class="math inline">\(\gamma\)</span> in <em>Model 2</em>.</p>
<pre class="r"><code>fit_3 &lt;- lmer(y ~  t + k * Z - 1 + (1|id:site) + (1|site), data = dd)</code></pre>
<div id="rwevxnxbjg" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rwevxnxbjg .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rwevxnxbjg .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwevxnxbjg .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rwevxnxbjg .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rwevxnxbjg .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwevxnxbjg .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rwevxnxbjg .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rwevxnxbjg .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rwevxnxbjg .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rwevxnxbjg .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rwevxnxbjg .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rwevxnxbjg .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rwevxnxbjg .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rwevxnxbjg .gt_from_md > :first-child {
  margin-top: 0;
}

#rwevxnxbjg .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rwevxnxbjg .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rwevxnxbjg .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rwevxnxbjg .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwevxnxbjg .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rwevxnxbjg .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rwevxnxbjg .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rwevxnxbjg .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rwevxnxbjg .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rwevxnxbjg .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwevxnxbjg .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rwevxnxbjg .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rwevxnxbjg .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rwevxnxbjg .gt_left {
  text-align: left;
}

#rwevxnxbjg .gt_center {
  text-align: center;
}

#rwevxnxbjg .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rwevxnxbjg .gt_font_normal {
  font-weight: normal;
}

#rwevxnxbjg .gt_font_bold {
  font-weight: bold;
}

#rwevxnxbjg .gt_font_italic {
  font-style: italic;
}

#rwevxnxbjg .gt_super {
  font-size: 65%;
}

#rwevxnxbjg .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">-0.92</td>
<td class="gt_row gt_center">-2.1, 0.23</td>
<td class="gt_row gt_center">0.11</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">2.6</td>
<td class="gt_row gt_center">1.5, 3.8</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">4.9</td>
<td class="gt_row gt_center">3.7, 6.1</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">7.9</td>
<td class="gt_row gt_center">6.5, 9.2</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">11</td>
<td class="gt_row gt_center">9.2, 12</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">k</td>
<td class="gt_row gt_center">0.20</td>
<td class="gt_row gt_center">-0.12, 0.52</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">0.38</td>
<td class="gt_row gt_center">-0.57, 1.3</td>
<td class="gt_row gt_center">0.4</td></tr>
    <tr><td class="gt_row gt_left">k * Z</td>
<td class="gt_row gt_center">0.83</td>
<td class="gt_row gt_center">0.38, 1.3</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">id:site.sd__(Intercept)</td>
<td class="gt_row gt_center">6.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">2.1</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">4.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
<p>The notable difference between the the <em>Model 2</em> and <em>Model 3</em> estimates is that the width of the confidence interval for the treatment effect estimate is considerably larger in <em>Model 3</em>. We will see how this plays out in the power estimates down below.</p>
<p><strong>Model 4: ANCOVA</strong></p>
<p>The next model is an ANCOVA model that adjusts each follow-up outcome <span class="math inline">\(Y_1\)</span> with the observed baseline measurement <span class="math inline">\(Y_0.\)</span> Because we have only a single outcome per subject, the subject-specific effect <span class="math inline">\(sp_{ijkt}\)</span> disappears, and <span class="math inline">\(s_{ijt}\)</span> is now individual subject-level noise.</p>
<p><span class="math display">\[
Y_{ijt} = \alpha_t +  \beta Y_0 + \gamma Z_{jt}  + c_j + s_{ijt}
\]</span></p>
<pre class="r"><code>dd_b &lt;- dd[k ==0, .(id, y0 = y)]
dd_f &lt;- dd[k ==1, ]

dd &lt;- merge(dd_f, dd_b, by = &quot;id&quot;)

fit_4 &lt;- lmer(y ~  t +  y0 + Z  - 1 + (1|site), data = dd)</code></pre>
<div id="qkiydxocml" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#qkiydxocml .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#qkiydxocml .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkiydxocml .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#qkiydxocml .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#qkiydxocml .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkiydxocml .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#qkiydxocml .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#qkiydxocml .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#qkiydxocml .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#qkiydxocml .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#qkiydxocml .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#qkiydxocml .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#qkiydxocml .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#qkiydxocml .gt_from_md > :first-child {
  margin-top: 0;
}

#qkiydxocml .gt_from_md > :last-child {
  margin-bottom: 0;
}

#qkiydxocml .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#qkiydxocml .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#qkiydxocml .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkiydxocml .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#qkiydxocml .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#qkiydxocml .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#qkiydxocml .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#qkiydxocml .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#qkiydxocml .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkiydxocml .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#qkiydxocml .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#qkiydxocml .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#qkiydxocml .gt_left {
  text-align: left;
}

#qkiydxocml .gt_center {
  text-align: center;
}

#qkiydxocml .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#qkiydxocml .gt_font_normal {
  font-weight: normal;
}

#qkiydxocml .gt_font_bold {
  font-weight: bold;
}

#qkiydxocml .gt_font_italic {
  font-style: italic;
}

#qkiydxocml .gt_super {
  font-size: 65%;
}

#qkiydxocml .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">-0.11</td>
<td class="gt_row gt_center">-0.66, 0.44</td>
<td class="gt_row gt_center">0.7</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">1.1</td>
<td class="gt_row gt_center">0.54, 1.7</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">1.5</td>
<td class="gt_row gt_center">0.85, 2.2</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">2.9</td>
<td class="gt_row gt_center">2.1, 3.7</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">3.9</td>
<td class="gt_row gt_center">2.9, 4.8</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">y0</td>
<td class="gt_row gt_center">0.69</td>
<td class="gt_row gt_center">0.67, 0.72</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">0.74</td>
<td class="gt_row gt_center">0.06, 1.4</td>
<td class="gt_row gt_center">0.033</td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">0.64</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">5.8</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
<p><strong>Model 5: Change as outcome</strong></p>
<p>The final model considers the change from baseline to follow-up (<span class="math inline">\(D_{ijt} = Y_{ij1t} - Y_{ij0t}\)</span>) as the outcome of interest:</p>
<p><span class="math display">\[
D_{ijt} = \alpha_t + \gamma Z_{jt}  + c_j + s_{ijt}
\]</span></p>
<pre class="r"><code>dd[, d := y - y0]

fit_5 &lt;- lmer(d ~  t + Z - 1 + (1|site), data = dd)</code></pre>
<div id="rexelrsjke" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#rexelrsjke .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#rexelrsjke .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rexelrsjke .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#rexelrsjke .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#rexelrsjke .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rexelrsjke .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#rexelrsjke .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#rexelrsjke .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#rexelrsjke .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#rexelrsjke .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#rexelrsjke .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#rexelrsjke .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#rexelrsjke .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#rexelrsjke .gt_from_md > :first-child {
  margin-top: 0;
}

#rexelrsjke .gt_from_md > :last-child {
  margin-bottom: 0;
}

#rexelrsjke .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#rexelrsjke .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#rexelrsjke .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rexelrsjke .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#rexelrsjke .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#rexelrsjke .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#rexelrsjke .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#rexelrsjke .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#rexelrsjke .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rexelrsjke .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#rexelrsjke .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#rexelrsjke .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#rexelrsjke .gt_left {
  text-align: left;
}

#rexelrsjke .gt_center {
  text-align: center;
}

#rexelrsjke .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#rexelrsjke .gt_font_normal {
  font-weight: normal;
}

#rexelrsjke .gt_font_bold {
  font-weight: bold;
}

#rexelrsjke .gt_font_italic {
  font-style: italic;
}

#rexelrsjke .gt_super {
  font-size: 65%;
}

#rexelrsjke .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">0.17</td>
<td class="gt_row gt_center">-0.35, 0.69</td>
<td class="gt_row gt_center">0.5</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">0.33</td>
<td class="gt_row gt_center">-0.21, 0.88</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">-0.04</td>
<td class="gt_row gt_center">-0.66, 0.58</td>
<td class="gt_row gt_center">>0.9</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">0.55</td>
<td class="gt_row gt_center">-0.17, 1.3</td>
<td class="gt_row gt_center">0.13</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">0.63</td>
<td class="gt_row gt_center">-0.22, 1.5</td>
<td class="gt_row gt_center">0.15</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">0.58</td>
<td class="gt_row gt_center">-0.09, 1.3</td>
<td class="gt_row gt_center">0.087</td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">0.26</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">6.3</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="power-estimates" class="section level2">
<h2>Power estimates</h2>
<p>The ultimate goal of simulating data under different scenarios is to compare how efficiently different modeling assumptions estimate the treatment effect. In <em>frequentist</em> terms, if we assume a specific effect size, which model will lead us to the “correct” inference most often? Or putting it more technically, which model has the most statistical power?</p>
<p>By repeatedly generate data sets, we can estimate the parameters using each of the models and compare the overall proportion of data sets where the observed <em>p-value</em> is less than 0.05 to evaluate the power of each modeling approach. We have generated data under a range of effect size and time trend assumptions, as well as under the different random effect assumptions to see if relative power changes across different sets of assumptions.</p>
<p>The simulations were conducted under a range of sample size assumptions (we assumed between 12 and 60 clusters) as well as two different time trends. (See the last section of the <a href="#addendum">addendum</a> for example code used for the power analysis.) Power was estimated for each set of assumptions using 1500 data sets.</p>
<p>First up is Scenario 1:</p>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-21-1.png" width="1056" /></p>
<p>The curves in the figures show estimated power under a range of effect size (the columns of plots), time trends (the rows of plots) and sample size assumptions (the x-axes). In the case without any fixed or random period effects, there really is no difference between <em>Models 3, 4</em>, and <em>5</em>; power appears to be consistent under the different scenarios. <em>Model 2</em>, the Hussey &amp; Hughes model for baseline and follow-up measures, has the most power; this is not surprising, given that the model has an embedded set of simplifying assumptions relative to <em>Model 3</em> (see above). On the flip side, if those assumptions are violated, the <em>Model 3</em> estimates for the treatment effect may be biased, so it is not the obvious choice. On the other end of the spectrum, <em>Model 1</em> that ignores the baseline measures provides the least power; it seems pretty clear that if the two measurements are available, it would be unwise to throw out one of them.</p>
<p>The relative weakness of <em>Model 1</em> and relative strength (though potential bias) of <em>Model 2</em> persist in the remaining two scenarios (below), so the interesting question is how the remaining three models fare. In the second scenario, where there are fixed period effects but no random period effects, differences emerge. <em>Model 3</em>, the difference in change or Teerenstra model, appears to have more power than the ANCOVA or change models across all effect sizes and secular trends.</p>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-22-1.png" width="1056" /></p>
<p>In Scenario 3, where we have both fixed and random period effects, the general ordering of the models appears similar to the ranking in Scenario 2. However, <em>Model 5</em>, the change model appears, surprisingly, slightly superior to <em>Model 4</em>, the ANCOVA model.</p>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-23-1.png" width="1056" /></p>
<p>Back in the real world, of course, we do not know the true data generation process. It seems pretty clear that if we can make the assumptions that <span class="math inline">\(\gamma_0\)</span> and <span class="math inline">\(\gamma_1 = 0\)</span>, then <em>Model 2</em> appears to be the way to go. However, if we want to be careful not to introduce bias, <em>Model 3</em> might preferred.</p>
<p>The important thing to note is that statistical power translates directly to sample size. If we are interested in achieving 80% power, we can see how the number of required clusters is reduced as we move leftward across the horizontal white white lines in the plots, from <em>Model 1</em> to <em>Models 4 &amp; 5</em> to <em>Model 3</em> and then to <em>Model 2</em>. This is the design effect in action.</p>
<p>Of course, these conclusions are based on the specific data generating assumptions of the simulations. More general guidelines will require the formal derivation of design effects of the different models under the various scenarios. That is the next step.</p>
<p>
<p><small><font color="darkkhaki">
References:</p>
<p>Hussey, Michael A., and James P. Hughes. “Design and analysis of stepped wedge cluster randomized trials.” Contemporary clinical trials 28, no. 2 (2007): 182-191.</p>
<p>Teerenstra, Steven, Sandra Eldridge, Maud Graff, Esther de Hoop, and George F. Borm. “A simple sample size formula for analysis of covariance in cluster randomized trials.” Statistics in medicine 31, no. 20 (2012): 2169-2178.</p>
<p>Support:</p>
This work was supported in part by the National Institute on Aging (NIA) of the National Institutes of Health under Award Number U54AG063546, which funds the NIA IMbedded Pragmatic Alzheimer’s Disease and AD-Related Dementias Clinical Trials Collaboratory (<a href="https://impactcollaboratory.org/">NIA IMPACT Collaboratory</a>). The author, a member of the Design and Statistics Core, was the sole writer of this blog post and has no conflicts. The content is solely the responsibility of the author and does not necessarily represent the official views of the National Institutes of Health.
</font></small>
</p>
<p><a name="addendum"></a></p>
<p> </p>
</div>
<div id="addendum" class="section level2">
<h2>Addendum</h2>
<div id="a-general-data-generation-code-function-base_sw" class="section level3">
<h3>(A) General data generation code: function <code>base_sw</code></h3>
<pre class="r"><code>base_sw &lt;- function(effect, trend, nsites, nwaves, nperiods, n, s_c, s_cp, s_s, s_sp) {
  
  # define the cluster and subject level effects
  
  defC &lt;- defData(varname = &quot;c&quot;, formula = 0, variance = &quot;..s_c&quot;)
  defCP &lt;- defDataAdd(varname = &quot;c.p&quot;, formula = 0, variance = &quot;..s_cp&quot;)
  defS &lt;- defDataAdd(varname = &quot;s&quot;, formula = 0, variance = &quot;..s_s&quot;)
  defSP &lt;- defDataAdd(varname = &quot;y&quot;,
    formula = &quot;..trend * s_per + ..effect * Z * k + c + c.p + s&quot;, 
    variance = &quot;..s_sp&quot;
  )
  
  # generate clusters
  
  dsite &lt;- genData(nsites, defC, id = &quot;site&quot;)
  
  # generate cluster-period data
  
  dper &lt;- addPeriods(dsite, nPeriods = nperiods, idvars = &quot;site&quot;, 
                     timeid = &quot;s_time&quot;, perName = &quot;s_per&quot;)
  dper &lt;- addColumns(defCP, dper)
  
  # make treatment assignments
  
  dsw &lt;- trtStepWedge(dper, &quot;site&quot;, nWaves = nwaves, lenWaves = 1, 
                      startPer = 1, perName = &quot;s_per&quot;,
                      grpName = &quot;Z&quot;)
  
  # generate individual level data within each cluster
  
  dpat &lt;- genCluster(dper, cLevelVar = &quot;s_time&quot;, 
                     numIndsVar = n, level1ID = &quot;id&quot;)
  dpat &lt;- addColumns(defS, dpat)
  
  # generate two observation periods for each subject - baseline and follow-up
  
  dpat &lt;- addPeriods(dpat, nPeriods=2, idvars=&quot;id&quot;, timeid=&quot;p_time&quot;, perName=&quot;k&quot;)

  # merge subjects with stepped wedge assignments and generate outcome
  
  setkey(dpat, &quot;s_time&quot;, &quot;site&quot;, &quot;s_per&quot;, &quot;id&quot;)
  dsw[, c(&quot;c&quot;, &quot;c.p&quot;) := NULL]
  setkey(dsw, &quot;s_time&quot;, &quot;site&quot;, &quot;s_per&quot;)
  
  dpat &lt;- merge(dpat, dsw)
  setkey(dpat, &quot;id&quot;, &quot;k&quot;)
  dpat &lt;- addColumns(defSP, dpat)
}</code></pre>
</div>
<div id="b-model-3-under-scenarios-1-and-3" class="section level3">
<h3>(B) Model 3 under Scenarios 1 and 3</h3>
<p>The modeling examples above were based on Scenario 2 assumptions. Here is <em>Model 3</em> under Scenarios 1 and 3. (The other models would be described and implemented in similar fashion.)</p>
<div id="scenario-1" class="section level4">
<h4>Scenario 1</h4>
<p>In Scenario 1, there are no fixed or random period effects, so there is a constant intercept <span class="math inline">\(\alpha\)</span> for each period, rather than period-specific intercepts <span class="math inline">\(\alpha_t\)</span>, and there is no site-period random effect <span class="math inline">\(cp_{jt}\)</span>:</p>
<p><span class="math display">\[
Y_{ijkt} = \alpha + \gamma_0 k + \gamma_1 Z_{jk} + \gamma_2 k Z_{jk} + c_j  + s_{ijt} + sp_{ijkt}
\]</span></p>
<pre class="r"><code>dd &lt;- base_sw(effect = 1, trend = 0, 20, 4, 5, 30, 6, 0, 44, 20)

fit_1a &lt;- lmer(y ~  k * Z + (1|id:site) + (1|site), data = dd)</code></pre>
<div id="kicrbqohjt" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#kicrbqohjt .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kicrbqohjt .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kicrbqohjt .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kicrbqohjt .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kicrbqohjt .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kicrbqohjt .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kicrbqohjt .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kicrbqohjt .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kicrbqohjt .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kicrbqohjt .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kicrbqohjt .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kicrbqohjt .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#kicrbqohjt .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kicrbqohjt .gt_from_md > :first-child {
  margin-top: 0;
}

#kicrbqohjt .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kicrbqohjt .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kicrbqohjt .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#kicrbqohjt .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kicrbqohjt .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#kicrbqohjt .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kicrbqohjt .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kicrbqohjt .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kicrbqohjt .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kicrbqohjt .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kicrbqohjt .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#kicrbqohjt .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kicrbqohjt .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#kicrbqohjt .gt_left {
  text-align: left;
}

#kicrbqohjt .gt_center {
  text-align: center;
}

#kicrbqohjt .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kicrbqohjt .gt_font_normal {
  font-weight: normal;
}

#kicrbqohjt .gt_font_bold {
  font-weight: bold;
}

#kicrbqohjt .gt_font_italic {
  font-style: italic;
}

#kicrbqohjt .gt_super {
  font-size: 65%;
}

#kicrbqohjt .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">k</td>
<td class="gt_row gt_center">0.24</td>
<td class="gt_row gt_center">-0.09, 0.56</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">0.51</td>
<td class="gt_row gt_center">-0.11, 1.1</td>
<td class="gt_row gt_center">0.11</td></tr>
    <tr><td class="gt_row gt_left">k * Z</td>
<td class="gt_row gt_center">0.47</td>
<td class="gt_row gt_center">0.01, 0.93</td>
<td class="gt_row gt_center">0.044</td></tr>
    <tr><td class="gt_row gt_left">id:site.sd__(Intercept)</td>
<td class="gt_row gt_center">6.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">2.1</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">4.5</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
<div id="scenario-3" class="section level4">
<h4>Scenario 3</h4>
<p>Scenario 3 includes both fixed and random period effects, so we have <span class="math inline">\(\alpha_t\)</span> and <span class="math inline">\(cp_{jt}\)</span>.</p>
<p><span class="math display">\[
Y_{ijkt} = \alpha_t + \gamma_0 k + \gamma_1 Z_{jk} + \gamma_2 k Z_{jk} + c_j  + cp_{jt} + s_{ijt} + sp_{ijkt}
\]</span></p>
<pre class="r"><code>dd &lt;- base_sw(effect = 1, trend = 3, 20, 4, 5, 30, 4, 2, 44, 20)
dd[, t := factor(s_per, labels = c(1, 2, 3, 4, 5))]

fit_2a &lt;- lmer(y ~  t + k * Z - 1 + (1|id:site) + (1|s_time:site) + (1|site), 
  data = dd)</code></pre>
<div id="xltulzpqus" style="overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>html {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Helvetica Neue', 'Fira Sans', 'Droid Sans', Arial, sans-serif;
}

#xltulzpqus .gt_table {
  display: table;
  border-collapse: collapse;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#xltulzpqus .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xltulzpqus .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#xltulzpqus .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 0;
  padding-bottom: 6px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#xltulzpqus .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xltulzpqus .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#xltulzpqus .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#xltulzpqus .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#xltulzpqus .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#xltulzpqus .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#xltulzpqus .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#xltulzpqus .gt_group_heading {
  padding: 8px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
}

#xltulzpqus .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#xltulzpqus .gt_from_md > :first-child {
  margin-top: 0;
}

#xltulzpqus .gt_from_md > :last-child {
  margin-bottom: 0;
}

#xltulzpqus .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#xltulzpqus .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 12px;
}

#xltulzpqus .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xltulzpqus .gt_first_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
}

#xltulzpqus .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#xltulzpqus .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#xltulzpqus .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#xltulzpqus .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#xltulzpqus .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xltulzpqus .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding: 4px;
}

#xltulzpqus .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#xltulzpqus .gt_sourcenote {
  font-size: 90%;
  padding: 4px;
}

#xltulzpqus .gt_left {
  text-align: left;
}

#xltulzpqus .gt_center {
  text-align: center;
}

#xltulzpqus .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#xltulzpqus .gt_font_normal {
  font-weight: normal;
}

#xltulzpqus .gt_font_bold {
  font-weight: bold;
}

#xltulzpqus .gt_font_italic {
  font-style: italic;
}

#xltulzpqus .gt_super {
  font-size: 65%;
}

#xltulzpqus .gt_footnote_marks {
  font-style: italic;
  font-weight: normal;
  font-size: 65%;
}
</style>
<table class="gt_table">
  
  <thead class="gt_col_headings">
    <tr>
      <th class="gt_col_heading gt_columns_bottom_border gt_left" rowspan="1" colspan="1"><strong>Characteristic</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>Beta</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>95% CI</strong></th>
      <th class="gt_col_heading gt_columns_bottom_border gt_center" rowspan="1" colspan="1"><strong>p-value</strong></th>
    </tr>
  </thead>
  <tbody class="gt_table_body">
    <tr><td class="gt_row gt_left">t</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">1</td>
<td class="gt_row gt_center">-0.89</td>
<td class="gt_row gt_center">-2.1, 0.36</td>
<td class="gt_row gt_center">0.2</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">2</td>
<td class="gt_row gt_center">2.6</td>
<td class="gt_row gt_center">1.3, 3.9</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">3</td>
<td class="gt_row gt_center">6.0</td>
<td class="gt_row gt_center">4.6, 7.4</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">4</td>
<td class="gt_row gt_center">9.6</td>
<td class="gt_row gt_center">8.0, 11</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left" style="text-align: left; text-indent: 10px;">5</td>
<td class="gt_row gt_center">13</td>
<td class="gt_row gt_center">11, 15</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">k</td>
<td class="gt_row gt_center">0.07</td>
<td class="gt_row gt_center">-0.25, 0.38</td>
<td class="gt_row gt_center">0.7</td></tr>
    <tr><td class="gt_row gt_left">Z</td>
<td class="gt_row gt_center">-1.5</td>
<td class="gt_row gt_center">-2.9, -0.15</td>
<td class="gt_row gt_center">0.030</td></tr>
    <tr><td class="gt_row gt_left">k * Z</td>
<td class="gt_row gt_center">1.0</td>
<td class="gt_row gt_center">0.50, 1.4</td>
<td class="gt_row gt_center"><0.001</td></tr>
    <tr><td class="gt_row gt_left">id:site.sd__(Intercept)</td>
<td class="gt_row gt_center">6.8</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">s_time:site.sd__(Intercept)</td>
<td class="gt_row gt_center">1.4</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">site.sd__(Intercept)</td>
<td class="gt_row gt_center">1.9</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
    <tr><td class="gt_row gt_left">Residual.sd__Observation</td>
<td class="gt_row gt_center">4.4</td>
<td class="gt_row gt_center"></td>
<td class="gt_row gt_center"></td></tr>
  </tbody>
  
  
</table>
</div>
</div>
</div>
<div id="c-code-to-estimate-statistical-power" class="section level3">
<h3>(C) Code to estimate statistical power</h3>
<p>Here is the code to estimate statistical power of each model under a range of parameter assumptions, assuming Scenario 2 with fixed period effects. The estimation was conducted using a high performance computing cluster, because the replication process is computationally intensive.</p>
<pre class="r"><code>library(simstudy)
library(data.table)
library(slurmR)

s_single_rep &lt;- function(argsvec) {
  
  list2env(as.list(argsvec), envir = environment())

  dd &lt;- base_sw(effect, trend, sites, waves, periods, npat, 6, 0, 44, 20)
  
  # Model 1
  
  d_std &lt;- dd[k == 1]
  fit_1 &lt;-  lmer( y ~  t + Z  - 1 + (1|site), data = d_std)  
  pval_1 &lt;- coef(summary(fit_1))[&quot;Z&quot;, &quot;Pr(&gt;|t|)&quot;]
  
  # Model 2
  
  fit_2 &lt;- lmer(y ~ t + k:Z  - 1 +  (1|id:site) + (1|site), data = dd)
  pval_2 &lt;- coef(summary(fit_2))[&quot;k:Z&quot;, &quot;Pr(&gt;|t|)&quot;]
  
  # Model 3
  
  fit_3 &lt;- lmer(y ~  t + k * Z - 1 + (1|id:site) + (1|site), data = dd)
  pval_3 &lt;- coef(summary(fit_3))[&quot;k:Z&quot;, &quot;Pr(&gt;|t|)&quot;]
  
  # Model 4
  
  dd_b &lt;- dd[p_fu == 0, .(id, y0 = y)]
  dd_f &lt;- dd[p_fu == 1, ]
  dd_a &lt;- merge(dd_f, dd_b, by = &quot;id&quot;)
  
  fit_4 &lt;- lmer(y ~  t + k * Z - 1 + (1|id:site) + (1|site), data = dd_a)
  pval_4 &lt;- coef(summary(fit_4))[&quot;Z&quot;, &quot;Pr(&gt;|t|)&quot;]
  
  # Model 5
  
  dd[, d := y - y0]

  fit_5 &lt;- lmer(d ~  t + Z - 1 + (1|site), data = dd)
  pval_5 &lt;- coef(summary(fit_5))[&quot;Z&quot;, &quot;Pr(&gt;|t|)&quot;]
  
  ###
  
  data.table(pval_1, pval_2, pval_3, pval_4, pval_5)
  
}

s_replicate &lt;- function(argsvec) {
  
  model_results &lt;- rbindlist(
    parallel::mclapply(
      X = 1:1500, 
      FUN = function(x) s_single_rep(argsvec), 
      mc.cores = 8)
  )
  
  #--- summary statistics ---#
  
  power &lt;- model_results[, .(pval_1 = mean(pval_1 &lt;= 0.05),
                             pval_2 = mean(pval_2 &lt;= 0.05),
                             pval_3 = mean(pval_3 &lt;= 0.05),
                             pval_4 = mean(pval_4 &lt;= 0.05),
                             pval_5 = mean(pval_5 &lt;= 0.05)
  )]
  
  summary_stats &lt;- data.table(t(argsvec), power)
  
  return(summary_stats) # summary_stats is a data.table}

}

### Set simulation parameters

scenario_list &lt;- function(...) {
  argmat &lt;- expand.grid(...)
  return(asplit(argmat, MARGIN = 1))
}

effect &lt;- 1
trend &lt;- c(0, 3)
sites &lt;- c(12, 20, 28, 36, 44, 52, 60)
npat &lt;- 30
waves &lt;- 4
periods = 5

scenarios &lt;- scenario_list(effect = effect, trend = trend, 
  sites = sites, npat=npat, waves = waves, periods = periods)

### Execute simulation

job &lt;- Slurm_lapply(
  X = scenarios, 
  FUN = s_replicate, 
  njobs = min(length(scenarios), 90L), 
  mc.cores = 8L,
  job_name = &quot;i_swt&quot;,
  tmp_path = &quot;/gpfs/.../scratch&quot;,
  plan = &quot;wait&quot;,
  sbatch_opt = list(time = &quot;03:00:00&quot;, partition = &quot;cpu_short&quot;),
  export = c(&quot;simple_swt&quot;, &quot;base_swt&quot;, &quot;s_single_rep&quot;),
  overwrite = TRUE
)

### Gather and save results

res &lt;- Slurm_collect(job)
save(res, file = &quot;/gpfs/.../res.rda&quot;)</code></pre>
</div>
</div>
