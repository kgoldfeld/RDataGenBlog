---
title: 'simstudy enhancement: specifying idiosyncratic follow-up times for longitudinal
  data'
author: Package Build
date: '2024-04-16'
slug: []
categories: []
tags:
  - R
  - Longitudinal data
type: ''
subtitle: ''
image: ''
draft: true
---



<p>A researcher reached out to me a few weeks ago. They were trying to generate longitudinal data that included irregularly spaced follow-up periods. The default periods generated by the function <code>addPeriods</code> in the <code>simstudy</code> package are <span class="math inline">\(\{0, 1, 2, ..., n - 1\}\)</span>, where there are <span class="math inline">\(n\)</span> total periods. However, when follow-up periods required more specificity, such as <span class="math inline">\(\{0, 90, 180, 365\}\)</span> days from baseline, users had to manually add them. Originally, I had intended to incorporate this feature into the function, but unfortunately it slipped through the cracks. Thanks to the clear motivation provided by the researcher, I’ve implemented this enhancement. Users can now replace the default vector with their desired set of follow-up periods using the new argument <em>periodVec</em>. This addition is available in the development version of <code>simstudy</code> on GitHub.</p>
<p>Just as a quick introduction, here is a simple example that shows the default settings of <code>addPeriods</code>. We are generating three individuals that will have measurements at four different periods, generically identified as <span class="math inline">\(\{0, 1, 2, 3\}\)</span>:</p>
<pre class="r"><code>library(simstudy)
set.seed(123)

dd &lt;- genData(3)
dp &lt;- addPeriods(dd, nPeriods = 4)</code></pre>
<pre><code>## Key: &lt;timeID&gt;
##        id period timeID
##     &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
##  1:     1      0      1
##  2:     1      1      2
##  3:     1      2      3
##  4:     1      3      4
##  5:     2      0      5
##  6:     2      1      6
##  7:     2      2      7
##  8:     2      3      8
##  9:     3      0      9
## 10:     3      1     10
## 11:     3      2     11
## 12:     3      3     12</code></pre>
<p>In this next example, we still assume four measurement periods, but they will be at baseline, 90 days, 180 days, and 1 year. The outcome <span class="math inline">\(Y\)</span> that is a function of the day of follow-up:</p>
<pre class="r"><code>def &lt;- defDataAdd(varname = &quot;Y&quot;, formula = &quot;100 + 0.25 * day&quot;, variance = 400)

dd &lt;- genData(3)
dp &lt;- addPeriods(dd, nPeriods = 4, perName = &quot;day&quot;, periodVec = c(0, 90, 180, 365))
dp &lt;- addColumns(def, dp)</code></pre>
<p>Here is the resulting data set:</p>
<pre><code>## Key: &lt;timeID&gt;
##        id   day timeID         Y
##     &lt;int&gt; &lt;num&gt;  &lt;int&gt;     &lt;num&gt;
##  1:     1     0      1  88.79049
##  2:     1    90      2 117.89645
##  3:     1   180      3 176.17417
##  4:     1   365      4 192.66017
##  5:     2     0      5 102.58575
##  6:     2    90      6 156.80130
##  7:     2   180      7 154.21832
##  8:     2   365      8 165.94878
##  9:     3     0      9  86.26294
## 10:     3    90     10 113.58676
## 11:     3   180     11 169.48164
## 12:     3   365     12 198.44628</code></pre>
<p><img src="{{< blogdown/postref >}}index.en_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>
<p>The second example transforms data in “wide” format to “long” format. Here is the wide data generation:</p>
<pre class="r"><code>tdef &lt;- 
  defData(varname = &quot;Y0&quot;, dist = &quot;normal&quot;, formula = 10, variance = 1) |&gt;
  defData(varname = &quot;Y1&quot;, dist = &quot;normal&quot;, formula = &quot;Y0 + 5&quot;, variance = 1) |&gt;
  defData(varname = &quot;Y2&quot;, dist = &quot;normal&quot;, formula = &quot;Y0 + 10&quot;, variance = 1)

dd &lt;- genData(3, tdef)</code></pre>
<pre><code>## Key: &lt;id&gt;
##       id        Y0       Y1       Y2
##    &lt;int&gt;     &lt;num&gt;    &lt;num&gt;    &lt;num&gt;
## 1:     1 10.400771 17.18768 21.10213
## 2:     2 10.110683 15.60853 19.63789
## 3:     3  9.444159 12.47754 18.37634</code></pre>
<p>And here is the transformation, with the time periods:</p>
<pre class="r"><code>dp &lt;- addPeriods(
  dd, 
  perName = &quot;day&quot;, 
  timevars = paste0(&quot;Y&quot;, 0:2),
  timevarName = &quot;Y&quot;,
  periodVec = c(0, 180, 365)
)</code></pre>
<pre><code>## Key: &lt;timeID&gt;
##       id   day         Y timeID
##    &lt;int&gt; &lt;num&gt;     &lt;num&gt;  &lt;int&gt;
## 1:     1     0 10.400771      1
## 2:     1   180 17.187685      2
## 3:     1   365 21.102127      3
## 4:     2     0 10.110683      4
## 5:     2   180 15.608533      5
## 6:     2   365 19.637891      6
## 7:     3     0  9.444159      7
## 8:     3   180 12.477542      8
## 9:     3   365 18.376335      9</code></pre>
<p>As a little bonus, here is additional code to introduce a little more reality into the data generation process. In this case, not all the follow-up measurements would be collected precisely on the exact follow-up date (although all the baseline measurements would be made on day zero). In particular, we are assuming that about 60% of the cases would be collected <em>after</em> the scheduled time (never before). I’ve implemented this logic by creating a <em>lag</em> variable in the data definition:</p>
<pre class="r"><code>deflag &lt;- 
  defDataAdd(varname = &quot;lagdays&quot;, formula = 10, dist = &quot;noZeroPoisson&quot;) |&gt;
  defDataAdd(varname = &quot;lag&quot;, formula = &quot;0 | .4 + lagdays | .6&quot;, dist = &quot;mixture&quot;) |&gt;
  defDataAdd(varname = &quot;obs_day&quot;, formula = &quot;(day &gt; 0) * (day + lag)&quot;)

dd &lt;- genData(3)
dp &lt;- addPeriods(dd, 3, perName = &quot;day&quot;, periodVec = c(0, 180, 365))
dp &lt;- addColumns(deflag, dp)</code></pre>
<pre><code>## Key: &lt;timeID&gt;
##       id   day timeID lagdays   lag obs_day
##    &lt;int&gt; &lt;num&gt;  &lt;int&gt;   &lt;num&gt; &lt;num&gt;   &lt;num&gt;
## 1:     1     0      1       9     9       0
## 2:     1   180      2       9     9     189
## 3:     1   365      3       7     0     365
## 4:     2     0      4       7     7       0
## 5:     2   180      5       8     0     180
## 6:     2   365      6      10     0     365
## 7:     3     0      7       8     8       0
## 8:     3   180      8      13    13     193
## 9:     3   365      9       5     0     365</code></pre>
<p>Since <code>addPeriods</code> is a work in progress, feel free to reach out to me with suggestions, either directly or by creating an issue in GitHub.</p>
